<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prendre Rendez-vous - Bright Smile | Réservation en Ligne</title>
    <meta name="description" content="Prenez rendez-vous en ligne avec Dr. Ayad Soumia. Système de réservation simple et rapide pour tous vos soins dentaires.">
    
    <link rel="stylesheet" href="public-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        .appointment-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 120px 20px 60px;
        }
        
        .appointment-header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .appointment-header h1 {
            font-size: 2.5rem;
            color: var(--text-primary);
            margin-bottom: 15px;
        }
        
        .appointment-header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
        }
        
        .appointment-form-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .form-steps {
            display: flex;
            background: #f8f9fa;
            padding: 0;
        }
        
        .step {
            flex: 1;
            padding: 20px;
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: var(--primary-color);
            color: white;
        }
        
        .step.completed {
            background: #28a745;
            color: white;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
        }
        
        .step.active .step-number,
        .step.completed .step-number {
            background: rgba(255,255,255,0.3);
            color: white;
        }
        
        .step-title {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .form-content {
            padding: 40px;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
        
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .service-option {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .service-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .service-option.selected {
            border-color: var(--primary-color);
            background: rgba(0,0,0,0.05);
        }
        
        .service-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 1.5rem;
        }
        
        .service-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }
        
        .service-duration {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .calendar-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        
        .calendar {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .calendar-header {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
        }
        
        .calendar-nav-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        
        .calendar-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
        }
        
        .weekday {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        
        .calendar-day {
            padding: 15px 10px;
            text-align: center;
            border: 1px solid #f1f3f4;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-day:hover {
            background: #f8f9fa;
        }
        
        .calendar-day.selected {
            background: var(--primary-color);
            color: white;
        }
        
        .calendar-day.disabled {
            color: #ccc;
            cursor: not-allowed;
        }
        
        .calendar-day.other-month {
            color: #ccc;
            opacity: 0.5;
        }
        
        .calendar-day.today {
            background: #ffc107;
            color: #000;
            font-weight: 600;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .time-slot {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .time-slot:hover {
            border-color: var(--primary-color);
        }
        
        .time-slot.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .time-slot.unavailable {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .nav-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-prev {
            background: #6c757d;
            color: white;
        }
        
        .btn-next, .btn-submit {
            background: var(--gradient-primary);
            color: white;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .appointment-summary {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .summary-label {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .summary-value {
            color: var(--text-secondary);
        }
        
        @media (max-width: 768px) {
            .calendar-container {
                grid-template-columns: 1fr;
            }
            
            .form-steps {
                flex-direction: column;
            }
            
            .service-grid {
                grid-template-columns: 1fr;
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <a href="index-public.html" class="logo">
                <img src="logo.jpg" alt="Bright Smile" class="logo-img">
            </a>
            
            <nav>
                <ul class="nav-menu">
                    <li><a href="index-public.html">Accueil</a></li>
                    <li><a href="Espace medecin/services-public.html">Services</a></li>
                    <li><a href="index-public.html#apropos">À Propos</a></li>
                    <li><a href="doctor-profile.html">Dentiste</a></li>
                    <li><a href="index-public.html#temoignages">Témoignages</a></li>
                    <li><a href="index-public.html#galerie">Galerie</a></li>
                    <li><a href="blog-public.html">Blog</a></li>
                    <li><a href="index-public.html#contact">Contact</a></li>
                </ul>
            </nav>
            
            <div class="header-actions">
                <div class="access-dropdown">
                    <button class="access-toggle">
                        <i class="fas fa-user"></i>
                        <span>Accès</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu">
                        <a href="Espace medecin/espace-medecin.html" class="dropdown-item">
                            <i class="fas fa-user-md"></i>
                            <span>Espace Médecin</span>
                        </a>
                        <a href="index-public.html#espace-patient" class="dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>Espace Patient</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <button class="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Appointment Booking -->
    <div class="appointment-container">
        <div class="appointment-header">
            <h1>Prendre Rendez-vous</h1>
            <p>Réservez votre consultation en quelques clics</p>
        </div>
        
        <div class="appointment-form-container">
            <!-- Steps Indicator -->
            <div class="form-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-title">Service</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-title">Date & Heure</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-title">Informations</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-title">Confirmation</div>
                </div>
            </div>
            
            <div class="form-content">
                <!-- Step 1: Service Selection -->
                <div class="form-step active" id="step1">
                    <h3>Choisissez votre service</h3>
                    <div class="service-grid">
                        <div class="service-option" data-service="consultation">
                            <div class="service-icon">
                                <i class="fas fa-stethoscope"></i>
                            </div>
                            <div class="service-name">Consultation</div>
                            <div class="service-duration">30 min</div>
                        </div>
                        
                        <div class="service-option" data-service="esthetique">
                            <div class="service-icon">
                                <i class="fas fa-gem"></i>
                            </div>
                            <div class="service-name">Dentisterie Esthétique</div>
                            <div class="service-duration">60 min</div>
                        </div>
                        
                        <div class="service-option" data-service="implant">
                            <div class="service-icon">
                                <i class="fas fa-tooth"></i>
                            </div>
                            <div class="service-name">Implant Dentaire</div>
                            <div class="service-duration">90 min</div>
                        </div>
                        
                        <div class="service-option" data-service="orthodontie">
                            <div class="service-icon">
                                <i class="fas fa-smile"></i>
                            </div>
                            <div class="service-name">Orthodontie</div>
                            <div class="service-duration">45 min</div>
                        </div>
                        
                        <div class="service-option" data-service="endodontie">
                            <div class="service-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div class="service-name">Endodontie</div>
                            <div class="service-duration">75 min</div>
                        </div>
                        
                        <div class="service-option" data-service="hygiene">
                            <div class="service-icon">
                                <i class="fas fa-sparkles"></i>
                            </div>
                            <div class="service-name">Hygiène Dentaire</div>
                            <div class="service-duration">45 min</div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2: Date & Time Selection -->
                <div class="form-step" id="step2">
                    <h3>Choisissez la date et l'heure</h3>
                    <div class="calendar-container">
                        <div class="calendar">
                            <div class="calendar-header">
                                <button class="calendar-nav-btn" id="prevMonth">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="currentMonth">Janvier 2025</span>
                                <button class="calendar-nav-btn" id="nextMonth">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <div class="calendar-weekdays">
                                <div class="weekday">Dim</div>
                                <div class="weekday">Lun</div>
                                <div class="weekday">Mar</div>
                                <div class="weekday">Mer</div>
                                <div class="weekday">Jeu</div>
                                <div class="weekday">Ven</div>
                                <div class="weekday">Sam</div>
                            </div>
                            <div class="calendar-grid" id="calendarGrid">
                                <!-- Calendar days will be generated by JavaScript -->
                            </div>
                        </div>
                        
                        <div>
                            <h4>Créneaux disponibles</h4>
                            <div class="time-slots">
                                <div class="time-slot">09:00</div>
                                <div class="time-slot">09:30</div>
                                <div class="time-slot unavailable">10:00</div>
                                <div class="time-slot">10:30</div>
                                <div class="time-slot">11:00</div>
                                <div class="time-slot unavailable">11:30</div>
                                <div class="time-slot">14:00</div>
                                <div class="time-slot selected">14:30</div>
                                <div class="time-slot">15:00</div>
                                <div class="time-slot">15:30</div>
                                <div class="time-slot">16:00</div>
                                <div class="time-slot">16:30</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 3: Patient Information -->
                <div class="form-step" id="step3">
                    <h3>Vos informations</h3>
                    <form class="patient-info-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">Prénom *</label>
                                <input type="text" id="firstName" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Nom *</label>
                                <input type="text" id="lastName" name="lastName" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Téléphone *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="birthDate">Date de naissance</label>
                            <input type="date" id="birthDate" name="birthDate">
                        </div>
                        
                        <div class="form-group">
                            <label for="reason">Motif de consultation</label>
                            <textarea id="reason" name="reason" rows="3" placeholder="Décrivez brièvement le motif de votre visite..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="newPatient">
                                <span class="checkmark"></span>
                                Je suis un nouveau patient
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="terms" required>
                                <span class="checkmark"></span>
                                J'accepte les <a href="#">conditions d'utilisation</a> et la <a href="#">politique de confidentialité</a>
                            </label>
                        </div>
                    </form>
                </div>
                
                <!-- Step 4: Confirmation -->
                <div class="form-step" id="step4">
                    <h3>Confirmation de votre rendez-vous</h3>
                    <div class="appointment-summary">
                        <div class="summary-item">
                            <span class="summary-label">Service :</span>
                            <span class="summary-value" id="summaryService">Consultation</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Date :</span>
                            <span class="summary-value" id="summaryDate">15 Janvier 2024</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Heure :</span>
                            <span class="summary-value" id="summaryTime">14:30</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Durée :</span>
                            <span class="summary-value" id="summaryDuration">30 minutes</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Patient :</span>
                            <span class="summary-value" id="summaryPatient">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Téléphone :</span>
                            <span class="summary-value" id="summaryPhone">-</span>
                        </div>
                    </div>
                    
                    <div class="confirmation-note">
                        <p><i class="fas fa-info-circle"></i> Un email de confirmation vous sera envoyé avec tous les détails de votre rendez-vous.</p>
                        <p><i class="fas fa-phone"></i> En cas de besoin, vous pouvez nous contacter au <strong>+213 5 41 70 60 27</strong></p>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="form-navigation">
                    <button type="button" class="nav-btn btn-prev" id="prevBtn" onclick="changeStep(-1)" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Précédent
                    </button>
                    <button type="button" class="nav-btn btn-next" id="nextBtn" onclick="changeStep(1)">
                        Suivant <i class="fas fa-arrow-right"></i>
                    </button>
                    <button type="button" class="nav-btn btn-submit" id="submitBtn" onclick="submitAppointment()" style="display: none;">
                        <i class="fas fa-check"></i> Confirmer le RDV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <!-- API Integration -->
    <script src="api-config.js"></script>
    <script src="api-client.js"></script>
    <script src="appointment-booking-backend.js"></script>
</body>
    <script>
        let currentStep = 1;
        let appointmentData = {};
        let currentDate = new Date();
        let selectedDate = null;
        
        // Calendar functionality
        const months = [
            'Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
            'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'
        ];
        
        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonthSpan = document.getElementById('currentMonth');
            
            currentMonthSpan.textContent = `${months[month]} ${year}`;
            calendarGrid.innerHTML = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                const prevMonth = new Date(year, month, 0);
                emptyDay.textContent = prevMonth.getDate() - startingDayOfWeek + i + 1;
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of the current month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const currentDayDate = new Date(year, month, day);
                
                // Mark today
                if (currentDayDate.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Disable past dates
                if (currentDayDate < today.setHours(0, 0, 0, 0)) {
                    dayElement.classList.add('disabled');
                } else {
                    // Add click event for available dates
                    dayElement.addEventListener('click', function() {
                        if (!this.classList.contains('disabled')) {
                            document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                            this.classList.add('selected');
                            selectedDate = new Date(year, month, day);
                            appointmentData.date = `${day} ${months[month]} ${year}`;
                            
                            // Update available time slots based on selected date
                            updateTimeSlots(selectedDate);
                        }
                    });
                }
                
                calendarGrid.appendChild(dayElement);
            }
            
            // Add empty cells for days after the last day of the month
            const totalCells = calendarGrid.children.length;
            const remainingCells = 42 - totalCells; // 6 rows × 7 days = 42 cells
            for (let i = 1; i <= remainingCells && i <= 14; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                emptyDay.textContent = i;
                calendarGrid.appendChild(emptyDay);
            }
        }
        
        function updateTimeSlots(selectedDate) {
            const timeSlotsContainer = document.querySelector('.time-slots');
            const timeSlots = [
                '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
                '14:00', '14:30', '15:00', '15:30', '16:00', '16:30'
            ];
            
            timeSlotsContainer.innerHTML = '';
            
            const today = new Date();
            const isToday = selectedDate.toDateString() === today.toDateString();
            const currentHour = today.getHours();
            const currentMinute = today.getMinutes();
            
            timeSlots.forEach(timeSlot => {
                const slotElement = document.createElement('div');
                slotElement.className = 'time-slot';
                slotElement.textContent = timeSlot;
                
                const [hours, minutes] = timeSlot.split(':').map(Number);
                const slotTime = hours * 60 + minutes;
                const currentTime = currentHour * 60 + currentMinute;
                
                // Disable past time slots for today
                if (isToday && slotTime <= currentTime) {
                    slotElement.classList.add('unavailable');
                } else {
                    // Randomly mark some slots as unavailable (simulate bookings)
                    if (Math.random() < 0.2) {
                        slotElement.classList.add('unavailable');
                    } else {
                        slotElement.addEventListener('click', function() {
                            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                            this.classList.add('selected');
                            appointmentData.time = this.textContent;
                        });
                    }
                }
                
                timeSlotsContainer.appendChild(slotElement);
            });
        }
        
        // Initialize calendar
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            
            // Calendar navigation
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            });
            
            document.getElementById('nextMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            });
        });
        
        // Service selection
        document.querySelectorAll('.service-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.service-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                appointmentData.service = this.dataset.service;
                appointmentData.serviceName = this.querySelector('.service-name').textContent;
                appointmentData.duration = this.querySelector('.service-duration').textContent;
            });
        });
        
        function changeStep(direction) {
            const totalSteps = 4;
            const newStep = currentStep + direction;
            
            if (newStep < 1 || newStep > totalSteps) return;
            
            // Validate current step
            if (direction > 0 && !validateStep(currentStep)) return;
            
            // Hide current step
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            if (direction > 0) {
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
            }
            
            // Show new step
            currentStep = newStep;
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            
            // Update navigation buttons
            updateNavigation();
            
            // Update summary if on confirmation step
            if (currentStep === 4) {
                updateSummary();
            }
        }
        
        function validateStep(step) {
            switch(step) {
                case 1:
                    if (!appointmentData.service) {
                        alert('Veuillez sélectionner un service');
                        return false;
                    }
                    break;
                case 2:
                    if (!appointmentData.date || !appointmentData.time) {
                        alert('Veuillez sélectionner une date et une heure');
                        return false;
                    }
                    break;
                case 3:
                    const form = document.querySelector('.patient-info-form');
                    const formData = new FormData(form);
                    const requiredFields = ['firstName', 'lastName', 'email', 'phone'];
                    
                    for (let field of requiredFields) {
                        if (!formData.get(field)) {
                            alert(`Veuillez remplir le champ ${field}`);
                            return false;
                        }
                    }
                    
                    if (!formData.get('terms')) {
                        alert('Veuillez accepter les conditions d\'utilisation');
                        return false;
                    }
                    
                    // Store form data
                    appointmentData.firstName = formData.get('firstName');
                    appointmentData.lastName = formData.get('lastName');
                    appointmentData.email = formData.get('email');
                    appointmentData.phone = formData.get('phone');
                    appointmentData.birthDate = formData.get('birthDate');
                    appointmentData.reason = formData.get('reason');
                    appointmentData.newPatient = formData.get('newPatient') ? 'Oui' : 'Non';
                    break;
            }
            return true;
        }
        
        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            nextBtn.style.display = currentStep < 4 ? 'block' : 'none';
            submitBtn.style.display = currentStep === 4 ? 'block' : 'none';
        }
        
        function updateSummary() {
            document.getElementById('summaryService').textContent = appointmentData.serviceName || '-';
            document.getElementById('summaryDate').textContent = appointmentData.date || '-';
            document.getElementById('summaryTime').textContent = appointmentData.time || '-';
            document.getElementById('summaryDuration').textContent = appointmentData.duration || '-';
            document.getElementById('summaryPatient').textContent = 
                appointmentData.firstName && appointmentData.lastName ? 
                `${appointmentData.firstName} ${appointmentData.lastName}` : '-';
            document.getElementById('summaryPhone').textContent = appointmentData.phone || '-';
        }
        
        async function submitAppointment() {
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Confirmation...';
            submitBtn.disabled = true;
            
            try {
                // Prepare appointment data for API
                const appointmentPayload = {
                    patient_id: null,
                    doctor_id: 1,
                    service_id: getServiceId(appointmentData.service),
                    appointment_date: formatDateForAPI(selectedDate),
                    appointment_time: appointmentData.time,
                    status: 'scheduled',
                    notes: appointmentData.reason || '',
                    patient_data: {
                        first_name: appointmentData.firstName,
                        last_name: appointmentData.lastName,
                        email: appointmentData.email,
                        phone: appointmentData.phone,
                        date_of_birth: appointmentData.birthDate,
                        role: 'patient'
                    }
                };

                // Try to call the backend API first
                let apiSuccess = false;
                try {
                    const response = await fetch('http://localhost:8000/api/appointments', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(appointmentPayload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        apiSuccess = true;
                        console.log('Rendez-vous créé via API:', result);
                    }
                } catch (apiError) {
                    console.log('API non disponible, sauvegarde locale:', apiError.message);
                }

                // If API fails, save locally for now
                if (!apiSuccess) {
                    saveAppointmentLocally(appointmentPayload);
                }

                alert('Rendez-vous confirmé ! Un email de confirmation vous a été envoyé.');
                window.location.href = 'index-public.html';

            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de la confirmation du rendez-vous. Veuillez réessayer ou nous contacter.');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        function saveAppointmentLocally(appointmentData) {
            // Save appointment to localStorage for now
            let appointments = JSON.parse(localStorage.getItem('pendingAppointments') || '[]');
            appointmentData.id = Date.now(); // Simple ID
            appointmentData.created_at = new Date().toISOString();
            appointments.push(appointmentData);
            localStorage.setItem('pendingAppointments', JSON.stringify(appointments));
            console.log('Rendez-vous sauvegardé localement:', appointmentData);
        }

        function getServiceId(serviceType) {
            const serviceMap = {
                'consultation': 1,
                'esthetique': 2,
                'implant': 3,
                'orthodontie': 4,
                'endodontie': 5,
                'hygiene': 6
            };
            return serviceMap[serviceType] || 1;
        }

        function formatDateForAPI(date) {
            if (!date) return null;
            return date.toISOString().split('T')[0];
        }
    </script>
</body>
</html>
